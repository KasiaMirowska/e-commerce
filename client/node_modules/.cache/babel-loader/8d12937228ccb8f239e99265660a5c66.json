{"ast":null,"code":"import _regeneratorRuntime from\"/Users/kamirska/UDEMYlearning/e-commerce/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Users/kamirska/UDEMYlearning/e-commerce/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(getSnapshotFromUserAuth),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(signInWithGoogle),_marked3=/*#__PURE__*/_regeneratorRuntime.mark(signInWithEmail),_marked4=/*#__PURE__*/_regeneratorRuntime.mark(onGoogleSignInStart),_marked5=/*#__PURE__*/_regeneratorRuntime.mark(onEmailSignInStart),_marked6=/*#__PURE__*/_regeneratorRuntime.mark(userSagas);import{takeLatest,put,all,call}from'redux-saga/effects';import UserActionTypes from'../user/user.types';import{auth,googleProvider,createUserProfileDocument,mDatabase}from'../../firebase/firebase.util';import{signInSuccess,signInFailure}from'../user/user.actions';function getSnapshotFromUserAuth(userAuth){var user,userSnapshot;return _regeneratorRuntime.wrap(function getSnapshotFromUserAuth$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return call(createUserProfileDocument,userAuth);case 3:user=_context.sent;_context.next=6;return user.get();case 6:userSnapshot=_context.sent;_context.next=9;return put(signInSuccess(_objectSpread({id:userSnapshot.id},userSnapshot.data())));case 9:_context.next=15;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);_context.next=15;return put(signInFailure(_context.t0));case 15:case\"end\":return _context.stop();}}},_marked,null,[[0,11]]);}function signInWithGoogle(){var userRef,user;return _regeneratorRuntime.wrap(function signInWithGoogle$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return auth.signInWithPopup(googleProvider);case 3:userRef=_context2.sent;user=userRef.user;_context2.next=7;return getSnapshotFromUserAuth(user);case 7:_context2.next=13;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);_context2.next=13;return put(signInFailure(_context2.t0));case 13:case\"end\":return _context2.stop();}}},_marked2,null,[[0,9]]);}//we're receiving action.payload here\nfunction signInWithEmail(_ref){var _ref$payload,email,password,userRef,user;return _regeneratorRuntime.wrap(function signInWithEmail$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_ref$payload=_ref.payload,email=_ref$payload.email,password=_ref$payload.password;_context3.prev=1;_context3.next=4;return auth.signInWithEmailAndPassword(email,password);case 4:userRef=_context3.sent;// const user = yield call(createUserProfileDocument, userRef.user);\n// const userSnapshot = yield user.get();\n//refactored to limit repeating code\nuser=userRef.user;_context3.next=8;return getSnapshotFromUserAuth(user);case 8:_context3.next=14;break;case 10:_context3.prev=10;_context3.t0=_context3[\"catch\"](1);_context3.next=14;return put(signInFailure(_context3.t0));case 14:case\"end\":return _context3.stop();}}},_marked3,null,[[1,10]]);}export function onGoogleSignInStart(){return _regeneratorRuntime.wrap(function onGoogleSignInStart$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return takeLatest(UserActionTypes.GOOGLE_SIGNIN_START,signInWithGoogle);case 2:case\"end\":return _context4.stop();}}},_marked4);}export function onEmailSignInStart(){return _regeneratorRuntime.wrap(function onEmailSignInStart$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return takeLatest(UserActionTypes.EMAIL_SIGNIN_START,signInWithEmail);case 2:case\"end\":return _context5.stop();}}},_marked5);}export function userSagas(){return _regeneratorRuntime.wrap(function userSagas$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return all([call(onGoogleSignInStart),call(onEmailSignInStart)]);case 2:case\"end\":return _context6.stop();}}},_marked6);}","map":{"version":3,"sources":["/Users/kamirska/UDEMYlearning/e-commerce/src/redux/user/user-sagas.js"],"names":["getSnapshotFromUserAuth","signInWithGoogle","signInWithEmail","onGoogleSignInStart","onEmailSignInStart","userSagas","takeLatest","put","all","call","UserActionTypes","auth","googleProvider","createUserProfileDocument","mDatabase","signInSuccess","signInFailure","userAuth","user","get","userSnapshot","id","data","signInWithPopup","userRef","payload","email","password","signInWithEmailAndPassword","GOOGLE_SIGNIN_START","EMAIL_SIGNIN_START"],"mappings":"sWAKUA,uB,iDAWAC,gB,iDAeAC,e,iDAgBOC,mB,iDAIAC,kB,iDAIAC,S,EAvDjB,OAASC,UAAT,CAAqBC,GAArB,CAA0BC,GAA1B,CAA+BC,IAA/B,KAA2C,oBAA3C,CACA,MAAOC,CAAAA,eAAP,KAA4B,oBAA5B,CACA,OAASC,IAAT,CAAeC,cAAf,CAA+BC,yBAA/B,CAA0DC,SAA1D,KAA2E,8BAA3E,CACA,OAAQC,aAAR,CAAuBC,aAAvB,KAA2C,sBAA3C,CAEA,QAAUhB,CAAAA,uBAAV,CAAkCiB,QAAlC,wLAEqB,MAAMR,CAAAA,IAAI,CAACI,yBAAD,CAA4BI,QAA5B,CAAV,CAFrB,OAEcC,IAFd,+BAG6B,MAAMA,CAAAA,IAAI,CAACC,GAAL,EAAN,CAH7B,OAGcC,YAHd,+BAKQ,MAAMb,CAAAA,GAAG,CAACQ,aAAa,gBAAEM,EAAE,CAAED,YAAY,CAACC,EAAnB,EAA0BD,YAAY,CAACE,IAAb,EAA1B,EAAd,CAAT,CALR,yGAOQ,MAAMf,CAAAA,GAAG,CAACS,aAAa,aAAd,CAAT,CAPR,qEAWA,QAAUf,CAAAA,gBAAV,kLAGwB,MAAMU,CAAAA,IAAI,CAACY,eAAL,CAAqBX,cAArB,CAAN,CAHxB,OAGcY,OAHd,gBAIeN,IAJf,CAIuBM,OAJvB,CAIeN,IAJf,kBAKQ,MAAMlB,CAAAA,uBAAuB,CAACkB,IAAD,CAA7B,CALR,4GAUQ,MAAMX,CAAAA,GAAG,CAACS,aAAa,cAAd,CAAT,CAVR,sEAcA;AACA,QAAUd,CAAAA,eAAV,iMAA2BuB,OAA3B,CAAqCC,KAArC,cAAqCA,KAArC,CAA4CC,QAA5C,cAA4CA,QAA5C,mCAEwB,MAAMhB,CAAAA,IAAI,CAACiB,0BAAL,CAAgCF,KAAhC,CAAuCC,QAAvC,CAAN,CAFxB,OAEcH,OAFd,gBAGQ;AACA;AACA;AACON,IANf,CAMuBM,OANvB,CAMeN,IANf,kBAOQ,MAAMlB,CAAAA,uBAAuB,CAACkB,IAAD,CAA7B,CAPR,8GAWQ,MAAMX,CAAAA,GAAG,CAACS,aAAa,cAAd,CAAT,CAXR,uEAgBA,MAAO,SAAUb,CAAAA,mBAAV,mJACH,MAAMG,CAAAA,UAAU,CAACI,eAAe,CAACmB,mBAAjB,CAAsC5B,gBAAtC,CAAhB,CADG,wDAIP,MAAO,SAAUG,CAAAA,kBAAV,kJACH,MAAME,CAAAA,UAAU,CAACI,eAAe,CAACoB,kBAAjB,CAAqC5B,eAArC,CAAhB,CADG,wDAIP,MAAO,SAAUG,CAAAA,SAAV,yIACH,MAAMG,CAAAA,GAAG,CAAC,CACNC,IAAI,CAACN,mBAAD,CADE,CAENM,IAAI,CAACL,kBAAD,CAFE,CAAD,CAAT,CADG","sourcesContent":["import { takeLatest, put, all, call } from 'redux-saga/effects';\nimport UserActionTypes from '../user/user.types';\nimport { auth, googleProvider, createUserProfileDocument, mDatabase } from '../../firebase/firebase.util';\nimport {signInSuccess, signInFailure} from '../user/user.actions';\n\nfunction* getSnapshotFromUserAuth(userAuth) {\n    try {\n        const user = yield call(createUserProfileDocument, userAuth);\n        const userSnapshot = yield user.get();\n        //put method puts received data back into redux flow\n        yield put(signInSuccess({id: userSnapshot.id, ...userSnapshot.data()}));\n    }catch(err) {\n        yield put(signInFailure(err))\n    }\n}\n\nfunction* signInWithGoogle() {\n    //api call here to sign in instead of in App.js:\n    try {\n        const userRef = yield auth.signInWithPopup(googleProvider);\n        const {user} = userRef;\n        yield getSnapshotFromUserAuth(user)\n    \n       \n       \n    } catch (err) {\n        yield put(signInFailure(err))\n    }\n}\n\n//we're receiving action.payload here\nfunction* signInWithEmail({payload: {email, password}}) {\n    try{\n        const userRef = yield auth.signInWithEmailAndPassword(email, password);\n        // const user = yield call(createUserProfileDocument, userRef.user);\n        // const userSnapshot = yield user.get();\n        //refactored to limit repeating code\n        const {user} = userRef;\n        yield getSnapshotFromUserAuth(user)\n        // yield put(signInSuccess({id: userSnapshot.id, ...userSnapshot.data()}));\n\n    }catch(err) {\n        yield put(signInFailure(err))\n    }\n}\n\n\nexport function* onGoogleSignInStart() {\n    yield takeLatest(UserActionTypes.GOOGLE_SIGNIN_START, signInWithGoogle)\n}\n\nexport function* onEmailSignInStart() {\n    yield takeLatest(UserActionTypes.EMAIL_SIGNIN_START, signInWithEmail)\n}\n\nexport function* userSagas () {\n    yield all([\n        call(onGoogleSignInStart),\n        call(onEmailSignInStart)\n    ])\n}"]},"metadata":{},"sourceType":"module"}